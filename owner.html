<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Owner Panel | School Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { 
      getFirestore, collection, getDocs, 
      doc, updateDoc, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ğŸ”¥ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
      authDomain: "schoolmanager-1bab3.firebaseapp.com",
      projectId: "schoolmanager-1bab3",
      storageBucket: "schoolmanager-1bab3.firebasestorage.app",
      messagingSenderId: "365294333627",
      appId: "1:365294333627:web:b98978770a9e70adc7439e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ğŸ” UID Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ (Owner)
    const OWNER_UID = "LnaJEMsXFJPiEDprpMS2CWgj0h92";

    // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©: Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¥Ù„Ø§ Ù„Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
    onAuthStateChanged(auth, (user) => {
      if (!user || user.uid !== OWNER_UID) {
        alert("ğŸš« ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„");
        window.location.href = "/admin/login.html";
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†Ø§Øª
    async function loadAdmins() {
      const tbody = document.getElementById("adminsTable");
      tbody.innerHTML = "";

      const querySnapshot = await getDocs(collection(db, "admins"));

      querySnapshot.forEach((docSnap) => {
        const admin = docSnap.data();
        const id = docSnap.id;

        const row = document.createElement("tr");
        row.className = "border-b";

        row.innerHTML = `
          <td class="p-3">${admin.name}</td>
          <td class="p-3">${admin.email}</td>
          <td class="p-3">${admin.phone}</td>
          <td class="p-3">
            <span class="px-3 py-1 rounded-full text-sm ${
              admin.status === "approved"
                ? "bg-green-100 text-green-700"
                : admin.status === "rejected"
                ? "bg-red-100 text-red-700"
                : "bg-yellow-100 text-yellow-700"
            }">
              ${admin.status}
            </span>
          </td>
          <td class="p-3 flex gap-2">
            <button onclick="approveAdmin('${id}')" class="bg-green-600 text-white px-3 py-1 rounded">
              Ù‚Ø¨ÙˆÙ„
            </button>
            <button onclick="rejectAdmin('${id}')" class="bg-red-600 text-white px-3 py-1 rounded">
              Ø±ÙØ¶
            </button>
            <button onclick="deleteAdmin('${id}')" class="bg-gray-600 text-white px-3 py-1 rounded">
              Ø­Ø°Ù
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
    window.approveAdmin = async (id) => {
      await updateDoc(doc(db, "admins", id), {
        status: "approved"
      });
      alert("âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†");
      loadAdmins();
    };

    // Ø±ÙØ¶ Ø§Ù„Ø£Ø¯Ù…Ù†
    window.rejectAdmin = async (id) => {
      await updateDoc(doc(db, "admins", id), {
        status: "rejected"
      });
      alert("âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø£Ø¯Ù…Ù†");
      loadAdmins();
    };

    // Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù…Ù† Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§
    window.deleteAdmin = async (id) => {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ")) return;
      await deleteDoc(doc(db, "admins", id));
      alert("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù");
      loadAdmins();
    };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.onload = loadAdmins;

  </script>
</head>

<body class="bg-gray-100 min-h-screen p-8">

  <h1 class="text-3xl font-bold text-center text-blue-600 mb-8">
    Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„Ùƒ (Owner)
  </h1>

  <div class="bg-white rounded-2xl shadow overflow-x-auto">
    <table class="w-full text-sm text-right">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-3">Ø§Ù„Ø§Ø³Ù…</th>
          <th class="p-3">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
          <th class="p-3">Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th class="p-3">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th class="p-3">Ø§Ù„ØªØ­ÙƒÙ…</th>
        </tr>
      </thead>
      <tbody id="adminsTable"></tbody>
    </table>
  </div>

  <!-- Ø²Ø± ÙØªØ­ Ø¨ÙˆØª Telegram -->
  <div class="mt-8 text-center">
    <a href="https://t.me/msayment_bot" target="_blank"
      class="inline-block bg-blue-600 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-700">
      ÙØªØ­ Ø¨ÙˆØª Telegram (ÙˆØµÙˆÙ„Ø§Øª CCP)
    </a>
  </div>

</body>
</html>