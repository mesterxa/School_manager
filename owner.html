<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner Panel | School Manager</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
body { font-family: 'Inter', sans-serif; }
</style>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen">

<header class="bg-black text-white py-4 px-6">
  <h1 class="text-xl font-black">ğŸ‘‘ Owner Control Panel</h1>
  <p class="text-sm text-gray-300">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† + CCP</p>
</header>

<main class="max-w-6xl mx-auto p-6">

<section class="bg-white rounded-2xl shadow p-6">
<h2 class="text-xl font-bold mb-6">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h2>

<table class="w-full text-sm">
<thead>
<tr class="text-gray-500">
  <th>Ø§Ù„Ø§Ø³Ù…</th>
  <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
  <th>Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</th>
  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody id="adminsTable"></tbody>
</table>

</section>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  doc,
  updateDoc,
  deleteDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
  authDomain: "schoolmanager-1bab3.firebaseapp.com",
  projectId: "schoolmanager-1bab3",
  storageBucket: "schoolmanager-1bab3.firebasestorage.app",
  messagingSenderId: "365294333627",
  appId: "1:365294333627:web:b98978770a9e70adc7439e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/*
âš ï¸ Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©:
Ø¶Ø¹ UID Ø­Ø³Ø§Ø¨Ùƒ Ø£Ù†Øª Ù‡Ù†Ø§ (Owner)
*/
const OWNER_UID = "PUT_YOUR_OWNER_UID_HERE";

onAuthStateChanged(auth, user => {
  if (!user || user.uid !== OWNER_UID) {
    alert("ğŸš« ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ");
    location.href = "/";
  }
});

const adminsTable = document.getElementById("adminsTable");

onSnapshot(collection(db, "admins"), snap => {
  adminsTable.innerHTML = "";
  snap.forEach(docSnap => {
    const a = docSnap.data();
    if (a.status === "pending") {
      adminsTable.innerHTML += `
      <tr>
        <td>${a.name}</td>
        <td>${a.email}</td>
        <td>
          <a href="${a.paymentImage || '#'}" target="_blank"
             class="text-blue-600 underline">
             Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
          </a>
        </td>
        <td class="flex gap-2">
          <button onclick="approve('${docSnap.id}')"
            class="bg-green-600 text-white px-3 py-1 rounded">
            Ù‚Ø¨ÙˆÙ„
          </button>
          <button onclick="reject('${docSnap.id}')"
            class="bg-red-600 text-white px-3 py-1 rounded">
            Ø±ÙØ¶
          </button>
        </td>
      </tr>`;
    }
  });
});

window.approve = async id => {
  await updateDoc(doc(db,"admins",id), { status:"active" });
  alert("âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„");
};

window.reject = async id => {
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù…Ù† Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")){
    await deleteDoc(doc(db,"admins",id));
  }
};
</script>

</body>
</html>