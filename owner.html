<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Owner</title>
<script src="https://cdn.tailwindcss.com"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
  authDomain: "schoolmanager-1bab3.firebaseapp.com",
  projectId: "schoolmanager-1bab3"
});

const db = getFirestore(app);
const tbody = document.getElementById("tbody");

async function load() {
  tbody.innerHTML = "";
  const snap = await getDocs(collection(db, "admin_requests"));

  snap.forEach(d => {
    const r = d.data();
    if (r.approved) return;

    tbody.innerHTML += `
      <tr class="border">
        <td>${r.name}</td>
        <td>${r.email}</td>
        <td>${r.schoolName}</td>
        <td>
          <a href="${r.paymentPhotoUrl}" target="_blank" class="text-blue-600">الوصل</a>
        </td>
        <td>
          <button onclick="approve('${d.id}')" class="bg-green-600 text-white px-2">قبول</button>
          <button onclick="reject('${d.id}')" class="bg-red-600 text-white px-2">رفض</button>
        </td>
      </tr>
    `;
  });
}

window.approve = async (id) => {
  const snap = await getDocs(collection(db, "admin_requests"));
  const docSnap = snap.docs.find(d => d.id === id);
  const data = docSnap.data();

  await addDoc(collection(db, "admins"), {
    name: data.name,
    email: data.email,
    phone: data.phone,
    password: data.password,
    schoolName: data.schoolName,
    createdAt: serverTimestamp()
  });

  await deleteDoc(doc(db, "admin_requests", id));
  load();
};

window.reject = async (id) => {
  await deleteDoc(doc(db, "admin_requests", id));
  load();
};

load();
</script>
</head>

<body class="p-6 bg-gray-100">
<table class="w-full bg-white">
<thead class="bg-gray-200">
<tr>
<th>الاسم</th><th>email</th><th>المدرسة</th><th>الوصل</th><th>إجراء</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</body>
</html>