<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุชุณุฌูู ุฃุฏูู ุฌุฏูุฏ | School Manager</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ๐ฅ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
      authDomain: "schoolmanager-1bab3.firebaseapp.com",
      projectId: "schoolmanager-1bab3",
      storageBucket: "schoolmanager-1bab3.firebasestorage.app",
      messagingSenderId: "365294333627",
      appId: "1:365294333627:web:b98978770a9e70adc7439e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const TELEGRAM_TOKEN = "8205787836:AAEgJSmusQzLonnQ7WeeR01RZ04YFhpxzA8";
    const TELEGRAM_CHAT_ID = "6858411980"; // ุถุน ููุง Chat ID ุงูุฎุงุต ุจู

    window.registerAdmin = async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone").value;
      const password = document.getElementById("password").value;
      const ccpFile = document.getElementById("ccpFile").files[0];

      if (!ccpFile) {
        alert("๐จ ุงูุฑุฌุงุก ุฑูุน ุตูุฑุฉ ุงูุฏูุน (CCP)");
        return;
      }

      try {
        // ุฅูุดุงุก ูุณุชุฎุฏู Firebase Auth
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        // ุฅุถุงูุฉ ุงูุฃุฏูู ุงูุฌุฏูุฏ ุฅูู Firestore ูุน ุญุงูุฉ pending
        await addDoc(collection(db, "admins"), {
          uid,
          name,
          email,
          phone,
          status: "pending"
        });

        // ุฅุฑุณุงู ุตูุฑุฉ ุงูุฏูุน ุฅูู Telegram
        const formData = new FormData();
        formData.append("chat_id", TELEGRAM_CHAT_ID);
        formData.append("photo", ccpFile);
        formData.append("caption", `๐ ุทูุจ ุชุณุฌูู ุฃุฏูู ุฌุฏูุฏ\n๐ค ุงูุงุณู: ${name}\n๐ง ุงูุจุฑูุฏ: ${email}\n๐ ุงููุงุชู: ${phone}`);

        fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
          method: "POST",
          body: formData
        })
        .then(() => {
          alert("โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญุ ูู ุงูุชุธุงุฑ ููุงููุฉ Owner");
          document.getElementById("registerForm").reset();
        })
        .catch(() => {
          alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู CCP ุฅูู Telegram");
        });

      } catch (error) {
        console.error(error);
        alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู: " + error.message);
      }
    };
  </script>
</head>

<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

  <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
    <h1 class="text-2xl font-bold text-center text-blue-600 mb-6">ุชุณุฌูู ุฃุฏูู ุฌุฏูุฏ</h1>

    <form id="registerForm" onsubmit="registerAdmin(event)" class="space-y-5">

      <div>
        <label class="block mb-1 font-semibold">ุงูุงุณู ุงููุงูู</label>
        <input type="text" id="name" required
          class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="ูุซุงู: ูุญูุฏ ุฃุญูุฏ">
      </div>

      <div>
        <label class="block mb-1 font-semibold">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" id="email" required
          class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="admin@example.com">
      </div>

      <div>
        <label class="block mb-1 font-semibold">ุฑูู ุงููุงุชู</label>
        <input type="tel" id="phone" required
          class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="05xxxxxxxx">
      </div>

      <div>
        <label class="block mb-1 font-semibold">ูููุฉ ุงููุฑูุฑ</label>
        <input type="password" id="password" required
          class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="********">
      </div>

      <div>
        <label class="block mb-1 font-semibold">ุฑูุน ุตูุฑุฉ ุงูุฏูุน (CCP)</label>
        <input type="file" id="ccpFile" accept="image/*" required
          class="w-full border rounded-xl p-3">
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition">
        ุชุณุฌูู ูุฅุฑุณุงู CCP
      </button>
    </form>

    <p class="mt-4 text-center text-gray-500 text-sm">
      ุจุนุฏ ุงูุชุณุฌููุ ุณูููู Owner ุจุงูููุงููุฉ ุนูู ุงูุญุณุงุจ.
    </p>
  </div>

</body>
</html>