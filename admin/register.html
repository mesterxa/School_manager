<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل أدمن</title>
<script src="https://cdn.tailwindcss.com"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
  authDomain: "schoolmanager-1bab3.firebaseapp.com",
  projectId: "schoolmanager-1bab3",
  storageBucket: "schoolmanager-1bab3.appspot.com",
  messagingSenderId: "365294333627",
  appId: "1:365294333627:web:b98978770a9e70adc7439e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

window.submitForm = async () => {
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const phone = phoneInput.value.trim();
  const password = passwordInput.value.trim();
  const school = schoolInput.value.trim();
  const file = receiptInput.files[0];

  if (!name || !email || !phone || !password || !school || !file) {
    alert("املأ كل الحقول");
    return;
  }

  try {
    const receiptRef = ref(storage, `payment_receipts/${Date.now()}_${file.name}`);
    await uploadBytes(receiptRef, file);
    const url = await getDownloadURL(receiptRef);

    await addDoc(collection(db, "admin_requests"), {
      name,
      email,
      phone,
      password,
      schoolName: school,
      paymentPhotoUrl: url,
      approved: false,
      createdAt: serverTimestamp()
    });

    alert("تم إرسال الطلب بنجاح");
    form.reset();
  } catch (e) {
    console.error(e);
    alert("فشل الإرسال");
  }
};
</script>
</head>

<body class="bg-gray-100 flex justify-center items-center min-h-screen">
<form id="form" onsubmit="event.preventDefault(); submitForm();" class="bg-white p-6 rounded w-96 space-y-3">
  <h1 class="text-xl font-bold text-center">تسجيل أدمن</h1>
  <input id="nameInput" placeholder="الاسم الكامل" class="w-full border p-2">
  <input id="emailInput" placeholder="email" class="w-full border p-2">
  <input id="phoneInput" placeholder="الهاتف" class="w-full border p-2">
  <input id="passwordInput" type="password" placeholder="كلمة المرور" class="w-full border p-2">
  <input id="schoolInput" placeholder="اسم المدرسة" class="w-full border p-2">
  <input id="receiptInput" type="file" class="w-full border p-2">
  <button class="w-full bg-blue-600 text-white py-2">إرسال</button>
</form>
</body>
</html>