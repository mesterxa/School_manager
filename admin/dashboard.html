<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | EduDZ</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .hidden { display: none; }
  </style>
</head>

<body class="bg-gray-100 flex min-h-screen">

<!-- SIDEBAR -->
<aside class="w-64 bg-gray-900 text-gray-100 flex flex-col fixed h-full">
  <div class="p-6 border-b border-gray-800">
    <h1 class="text-2xl font-black text-blue-500">EduDZ</h1>
    <p class="text-sm text-gray-400 mt-1">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
  </div>

  <nav class="flex-1 p-4 space-y-2 text-sm">
    <button class="block w-full text-left px-4 py-2 rounded-lg bg-blue-600 section-btn" data-section="overview">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="teachers">ğŸ‘¨â€ğŸ« Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="students">ğŸ‘¨â€ğŸ“ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="payments">ğŸ’³ Ø§Ù„Ø¯ÙÙˆØ¹Ø§Øª</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="courses">ğŸ“š Ø§Ù„Ø¯ÙˆØ±Ø§Øª</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="posts">ğŸ“ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</button>
    <button class="block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 section-btn" data-section="attendance">ğŸ“Œ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¯ÙÙˆØ¹</button>
  </nav>

  <div class="p-4 border-t border-gray-800">
    <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 py-2 rounded-lg font-semibold text-sm">
      ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    </button>
  </div>
</aside>

<!-- MAIN CONTENT -->
<main class="flex-1 ml-64 p-8 space-y-6">

  <!-- Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© -->
  <section id="overview" class="section">
    <h2 class="text-3xl font-bold mb-6">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© ğŸ‘‹</h2>
    <div class="grid md:grid-cols-4 gap-6">
      <div class="bg-white rounded-2xl shadow p-6">
        <p class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</p>
        <p class="text-3xl font-black text-blue-600" id="totalTeachers">0</p>
      </div>
      <div class="bg-white rounded-2xl shadow p-6">
        <p class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</p>
        <p class="text-3xl font-black text-green-600" id="totalStudents">0</p>
      </div>
      <div class="bg-white rounded-2xl shadow p-6">
        <p class="text-sm text-gray-500">Ø§Ù„Ø¯ÙÙˆØ¹Ø§Øª</p>
        <p class="text-3xl font-black text-purple-600" id="totalPayments">0</p>
      </div>
      <div class="bg-white rounded-2xl shadow p-6">
        <p class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</p>
        <p class="text-3xl font-black text-orange-600" id="totalPosts">0</p>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© -->
  <section id="teachers" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h2>
    <div id="teachersList" class="space-y-4"></div>
  </section>

  <!-- Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° -->
  <section id="students" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</h2>
    <div id="studentsList" class="space-y-4"></div>
  </section>

  <!-- Ø§Ù„Ø¯ÙÙˆØ¹Ø§Øª -->
  <section id="payments" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">Ø§Ù„Ø¯ÙÙˆØ¹Ø§Øª</h2>
    <div id="paymentsList" class="space-y-4"></div>
  </section>

  <!-- Ø§Ù„Ø¯ÙˆØ±Ø§Øª -->
  <section id="courses" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h2>
    <div id="coursesList" class="space-y-4"></div>
  </section>

  <!-- Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª -->
  <section id="posts" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
    <div id="postsList" class="space-y-4"></div>
  </section>

  <!-- Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¯ÙÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© -->
  <section id="attendance" class="section hidden">
    <h2 class="text-3xl font-bold mb-4">ğŸ“Œ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¯ÙÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</h2>
    <div id="attendanceList" class="space-y-4"></div>
  </section>

</main>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// config
const firebaseConfig = {
  apiKey: "AIzaSyCODe3VO-CPq-029218YsgaUQ9MKp90E3k",
  authDomain: "schoolmanager-1bab3.firebaseapp.com",
  projectId: "schoolmanager-1bab3",
  storageBucket: "schoolmanager-1bab3.firebasestorage.app",
  messagingSenderId: "365294333627",
  appId: "1:365294333627:web:b98978770a9e70adc7439e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    loadDashboard(user.uid);
  }
});

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
document.getElementById("logoutBtn").addEventListener("click", () => {
  signOut(auth).then(() => window.location.href = "login.html");
});

// Sidebar switch sections
document.querySelectorAll(".section-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.dataset.section;
    document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
    document.getElementById(target).classList.remove("hidden");
  });
});

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Dashboard
async function loadDashboard(adminId) {
  const teachersSnap = await getDocs(collection(db, "admins", adminId, "teachers"));
  let totalTeachers = teachersSnap.size;
  let totalStudents = 0;
  let totalPayments = 0;
  let totalPosts = 0;

  const teachersList = document.getElementById("teachersList");
  const studentsList = document.getElementById("studentsList");
  const paymentsList = document.getElementById("paymentsList");
  const postsList = document.getElementById("postsList");
  const attendanceList = document.getElementById("attendanceList");

  teachersList.innerHTML = studentsList.innerHTML = paymentsList.innerHTML = postsList.innerHTML = attendanceList.innerHTML = "";

  for (const teacherDoc of teachersSnap.docs) {
    const tData = teacherDoc.data();

    // Ø¹Ø±Ø¶ Teacher
    const tDiv = document.createElement("div");
    tDiv.className = "bg-white p-4 rounded-xl shadow";
    tDiv.textContent = `ğŸ‘¨â€ğŸ« ${tData.name} - Ø§Ù„Ù…Ø§Ø¯Ø©: ${tData.subject}`;
    teachersList.appendChild(tDiv);

    // Students
    const studentsSnap = await getDocs(collection(db, "admins", adminId, "teachers", teacherDoc.id, "students"));
    totalStudents += studentsSnap.size;

    for (const studentDoc of studentsSnap.docs) {
      const sData = studentDoc.data();

      // Ø¹Ø±Ø¶ Students
      const sDiv = document.createElement("div");
      sDiv.className = "bg-white p-3 rounded-lg shadow";
      sDiv.textContent = `ğŸ‘¨â€ğŸ“ ${sData.name} - ${sData.level} - ${sData.phone}`;
      studentsList.appendChild(sDiv);

      // Payments Ù„ÙƒÙ„ Student
      const paymentsSnap = await getDocs(collection(db, "admins", adminId, "teachers", teacherDoc.id, "students", studentDoc.id, "payments"));
      totalPayments += paymentsSnap.size;
      paymentsSnap.forEach(pDoc => {
        const pData = pDoc.data();
        const pDiv = document.createElement("div");
        pDiv.className = "bg-white p-3 rounded-lg shadow";
        pDiv.textContent = `ğŸ’³ ${pData.amount} Ø¯Ø¬ - ${pData.status} - ${pData.date}`;
        paymentsList.appendChild(pDiv);
      });

      // Attendance
      const attendanceSnap = await getDocs(collection(db, "admins", adminId, "teachers", teacherDoc.id, "students", studentDoc.id, "attendance"));
      attendanceSnap.forEach(aDoc => {
        const aData = aDoc.data();
        const aDiv = document.createElement("div");
        aDiv.className = "bg-white p-3 rounded-lg shadow";
        aDiv.innerHTML = `
          ğŸ‘¨â€ğŸ“ ${sData.name} | ğŸ“… ${aData.date} | ${aData.sessionType} | Ø§Ù„Ø­Ø§Ù„Ø©: ${aData.status} <br>
          ğŸ’° Ù…Ø¯ÙÙˆØ¹: ${aData.paidAmount} Ø¯Ø¬ | Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${aData.remainingAmount} Ø¯Ø¬ | Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${aData.paymentMethod}
        `;
        attendanceList.appendChild(aDiv);
      });
    }

    // Posts Ù„ÙƒÙ„ Teacher
    const postsSnap = await getDocs(collection(db, "admins", adminId, "teachers", teacherDoc.id, "posts"));
    totalPosts += postsSnap.size;
    postsSnap.forEach(postDoc => {
      const pData = postDoc.data();
      const postDiv = document.createElement("div");
      postDiv.className = "bg-white p-4 rounded-xl shadow";
      postDiv.innerHTML = `
        <h4 class="font-bold text-lg">${pData.title}</h4>
        <p class="text-gray-600 mt-1">${pData.content}</p>
        <p class="text-xs text-gray-400 mt-1">${pData.date}</p>
      `;
      postsList.appendChild(postDiv);
    });
  }

  document.getElementById("totalTeachers").textContent = totalTeachers;
  document.getElementById("totalStudents").textContent = totalStudents;
  document.getElementById("totalPayments").textContent = totalPayments;
  document.getElementById("totalPosts").textContent = totalPosts;
}

</script>
</body>
</html>